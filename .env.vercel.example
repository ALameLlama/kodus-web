# =============================================================================
# Vercel Preview Deployments - Environment Variables
# =============================================================================
# Set these in the Vercel Dashboard (Settings → Environment Variables)
# Scope: "Preview" only — so they don't affect Production deployments.
#
# To fetch QA values from AWS Parameter Store:
#   aws ssm get-parameters-by-path --path "/qa/kodus-web" --with-decryption \
#     --query "Parameters[*].{Name:Name,Value:Value}" --output table
# =============================================================================

# --- App ---
WEB_NODE_ENV="production"
# Do NOT set NEXTAUTH_URL — NextAuth v5 auto-detects from VERCEL_URL

# --- Auth ---
WEB_NEXTAUTH_SECRET="<from /qa/kodus-web/WEB_NEXTAUTH_SECRET>"

# --- API ---
WEB_HOSTNAME_API="<qa-api-hostname>"
WEB_PORT_API=""
# Do NOT set GLOBAL_API_CONTAINER_NAME (Docker-only, not used on Vercel)

# --- Billing ---
WEB_HOSTNAME_BILLING="<qa-billing-hostname>"
WEB_PORT_BILLING=""

# --- Analytics ---
WEB_ANALYTICS_HOSTNAME="<qa-analytics-hostname>"
WEB_ANALYTICS_SECRET="<from Parameter Store>"

# --- MCP Manager ---
WEB_HOSTNAME_MCP_MANAGER="<qa-mcp-manager-hostname>"
WEB_PORT_MCP_MANAGER=""

# --- GitHub OAuth (for GitHub login — see note below) ---
WEB_OAUTH_GITHUB_CLIENT_ID="<qa value>"
WEB_OAUTH_GITHUB_CLIENT_SECRET="<qa value>"
WEB_GITHUB_INSTALL_URL="<qa value>"

# --- GitLab OAuth ---
WEB_OAUTH_GITLAB_CLIENT_ID="<qa value>"
WEB_OAUTH_GITLAB_CLIENT_SECRET="<qa value>"
GLOBAL_GITLAB_CLIENT_ID="<qa value>"
GLOBAL_GITLAB_REDIRECT_URL="<needs to match preview URL — see note below>"
WEB_GITLAB_SCOPES="read_api read_user read_repository"
WEB_GITLAB_OAUTH_URL="https://gitlab.com/oauth/authorize"

# --- Bitbucket ---
WEB_BITBUCKET_INSTALL_URL="<qa value>"

# --- PostHog ---
WEB_POSTHOG_KEY="<qa value>"
NEXT_PUBLIC_POSTHOG_KEY="<qa value>"
NEXT_PUBLIC_POSTHOG_HOST="/ingest"

# --- Support/Docs URLs ---
WEB_SUPPORT_DOCS_URL="https://docs.kodus.io"
WEB_SUPPORT_DISCORD_INVITE_URL="https://discord.gg/QFzwwmNmdN"
WEB_SUPPORT_TALK_TO_FOUNDER_URL="https://cal.com/gabrielmalinosqui/30min"
WEB_TERMS_AND_CONDITIONS="<qa value>"
WEB_TOKEN_DOCS_GITHUB="https://docs.kodus.io/how_to_use/en/code_review/general_config/github_pat"
WEB_TOKEN_DOCS_GITLAB="https://docs.kodus.io/how_to_use/en/code_review/general_config/gitlab_pat"
WEB_TOKEN_DOCS_BITBUCKET="https://docs.kodus.io/how_to_use/en/code_review/general_config/bitbucket_pat"
WEB_TOKEN_DOCS_AZUREREPOS="https://docs.kodus.io/how_to_use/en/code_review/general_config/azure_devops_pat"

# =============================================================================
# IMPORTANT NOTES
# =============================================================================
#
# 1. OAuth Callbacks on Preview Deployments:
#    Each preview deploy gets a unique URL (e.g., kodus-web-git-feat-xxx.vercel.app).
#    GitHub/GitLab OAuth apps need the callback URL registered.
#    Options:
#    a) Use email/password login on previews (no OAuth config needed)
#    b) Create a separate OAuth App for previews with wildcard or multiple callbacks
#    c) Set up a stable preview domain (e.g., preview.kodus.io → latest preview)
#
# 2. CORS on QA APIs:
#    The QA backend must accept requests from *.vercel.app origins.
#    Update CORS config in the API to include: https://*.vercel.app
#
# 3. Network Access:
#    Vercel serverless functions need to reach QA APIs over the internet.
#    Ensure QA APIs are accessible (not behind a private VPC without public endpoint).
#
# 4. Ports:
#    Leave WEB_PORT_* empty when using HTTPS endpoints.
#    The createUrl helper uses HTTPS without port when WEB_NODE_ENV=production.
